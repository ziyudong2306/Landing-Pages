import{g as I}from"./_commonjsHelpers-BvkkSqj2.js";function L(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}var h,q;function x(){if(q)return h;q=1;function i(n){return t(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i,n)}function o(n){return t(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,n)}function r(n){return t(/^\+?[0-9]{1,4}?[-.\s]?(?:\([0-9]{1,4}\)|[0-9]{1,4})[-.\s]?[0-9]{1,4}[-.\s]?[0-9]{1,9}$/,n)}function t(n,a){return typeof a!="string"?!1:n.test(a.trim())}return h={validateUUID:i,validateEmail:o,validatePhoneNumber:r,validateRegex:t},h}var f,w;function _(){if(w)return f;w=1;function i(){const t=window.location.hostname.split("."),n=new Set([".co.uk",".com.au",".co.jp",".co.in",".com.br",".com.mx"]);for(let a=0;a<t.length-1;a++){const c="."+t.slice(a).join(".");if(n.has(c))return t.slice(a-1).join(".")}return t.slice(-2).join(".")}function o(){const r=window.location.protocol,t=i();return"".concat(r,"//tracktor.").concat(t)}return f={getMainDomain:i,getFirstPartyTrackingDomain:o},f}var l,k;function B(){if(k)return l;k=1;class i{constructor(){this.queue=[],this.lock=!1,this.processing=!1,this.initBuffer=[]}async acquire(r=5e3){const t=Date.now();for(;this.lock;){if(Date.now()-t>r){console.error("Lock acquisition timeout"),this.lock=!1;break}await new Promise(n=>setTimeout(n,10))}return this.lock=!0,!0}release(){this.lock=!1}async enqueue(r,t){if(!t){this.initBuffer.push(r);return}this.queue.push(r),this.processing||await this.processQueue()}async processInitBuffer(){for(const r of this.initBuffer)await this.enqueue(r,!0);this.initBuffer=[]}async processQueue(){if(!this.processing){await this.acquire();try{for(this.processing=!0;this.queue.length>0;){const r=this.queue.shift();try{await r()}catch(t){console.error("Error processing tracktor event:",r,t)}}}finally{this.processing=!1,this.release()}}}}return l=i,l}var d,y;function P(){if(y)return d;y=1;class i{constructor(){this.iframe=null}initialize(r,t){this.iframe=document.createElement("iframe"),this.iframe.width="1",this.iframe.height="1",this.iframe.style.border="0",this.iframe.onload=()=>{t()},this.iframe.onerror=()=>{throw new Error("Tracktor Iframe failed to load")},this.iframe.src=r,document.body.appendChild(this.iframe)}async postMessage(r,t,n){if(!this.iframe||!r)throw new Error("Tracktor not initialized properly");const a={type:t,detail:n};this.iframe.contentWindow.postMessage(a,"*")}}return d=i,d}var m,E;function z(){if(E)return m;E=1;const{validateUUID:i,validateEmail:o,validatePhoneNumber:r,validateRegex:t}=x(),{getFirstPartyTrackingDomain:n}=_(),a=B(),c=P();class T{constructor(e=null){this.url=e||n(),this.initialized=!1,this.queueManager=new a,this.iframeManager=new c,this.customEventsBuffer=[],this.pageViewCompleted=!1,this.setupRecordedEventListener()}setupRecordedEventListener(){window.addEventListener("message",e=>{if(e.data&&e.data.type==="client:recorded"&&(this.pageViewCompleted=!0,this.customEventsBuffer.length>0)){const s=[...this.customEventsBuffer];this.customEventsBuffer=[],s.forEach(u=>{this.enqueue(u)})}})}async acquire(e=5e3){return this.queueManager.acquire(e)}release(){this.queueManager.release()}async enqueue(e){return this.queueManager.enqueue(e,this.initialized)}async waitForQueueEmpty(){return this.queueManager.queue.length===0&&!this.queueManager.processing?Promise.resolve():new Promise(e=>{const s=()=>{this.queueManager.queue.length===0&&!this.queueManager.processing?e():setTimeout(s,10)};s()})}initialize(e){if(!i(e))throw new Error("Tracktor - invalid UUID");this.uuid=e,this.iframeManager.initialize(this.url,()=>{this.initialized=!0,this.queueManager.processInitBuffer()})}async pageView(e,s,u,D){let v={uuid:this.uuid,data:e,url:window.location.href,related_uuid:u,referrer:document.referrer||D||""};return s&&(v.segments=s),this.enqueue(()=>this.postMessage(this.uuid,"recordVisit",v))}async postMessage(e,s,u){return this.iframeManager.postMessage(e,s,u)}async recordEmail(e){if(o(e))return this.enqueue(()=>this.postMessage(this.uuid,"recordEmail",{uuid:this.uuid,email:e}))}async recordPhone(e){if(r(e))return this.enqueue(()=>this.postMessage(this.uuid,"recordPhone",{uuid:this.uuid,phone:e}))}async customEvent(e,s={}){if(!e||typeof e!="string"){console.error("Tracktor - invalid event name. Event name must be a non-empty string.");return}const u=()=>this.postMessage(this.uuid,"customEvent",{uuid:this.uuid,name:e,data:s});return this.pageViewCompleted?this.enqueue(u):(this.customEventsBuffer.push(u),Promise.resolve())}}return m=T,m}var g,M;function R(){return M||(M=1,g=z()),g}var b=R();const Q=I(b),p=new Q;window.addEventListener("load",function(){const i=document.querySelector('input[name="email"]');i&&i.addEventListener("change",function(){p.recordEmail(i.value).catch(t=>console.error(t))});const o=document.querySelector('input[name="_phone_number"]'),r=document.querySelector('input[name="phone_number"]');o&&r&&o.addEventListener("change",function(){p.recordPhone(r.value).catch(t=>console.error(t))})});window.tracktor=p;window.dispatchEvent(new Event("tracktor:init"));export{L as __vite_legacy_guard};
